
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Seats - {{ movie.title }}</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .seat { width: 30px; height: 30px; margin: 4px; border-radius: 4px; display: inline-block; line-height: 30px; text-align: center; font-size: 12px; cursor: pointer; }
    .available { background-color: lightgreen; }
    .reserved { background-color: gray; cursor: not-allowed; }
    .selected { background-color: coral; }
    .seat-row { text-align: center; margin-bottom: 10px; }
    .legend span { display: inline-block; margin-right: 10px; }
  </style>
</head>
<body class="bg-dark text-light">
  <div class="container mt-5">
    <h2 class="text-center mb-4">Book Your Seats for {{ movie.title }}</h2>
    <div class="legend text-center mb-3">
      <span class="seat available"></span> vip ₹{{ movie.price+100 }}
      <span class="seat available" style="background-color:#87CEFA"></span> Premium ₹{{ movie.price + 50 }}
      <span class="seat available" style="background-color:gold"></span> Normal ₹{{ movie.price }}
    </div>

    <form method="POST" action="{{ url_for('tickets') }}">
      <div class="screen text-center mb-3">SCREEN</div>
      {% for row in range(1, 11) %}
        <div class="seat-row">
          {% for col in range(1, 11) %}
            {% set seat_id = row|string + '-' + col|string %}
            {% set seat_class = "available" %}
            {% if row <= 3 %}
              {% set seat_type = 'NORMAL' %}
              {% set seat_color = 'gold' %}
              {% set price = movie.price %}
            {% elif row <= 6 %}
              {% set seat_type = 'Premium' %}
              {% set seat_color = '#87CEFA' %}
              {% set price = movie.price + 50 %}
            {% else %}
              {% set seat_type = 'VIP' %}
              {% set seat_color = 'lightgreen' %}
              {% set price = movie.price+100 %}
            {% endif %}
            {% if seat_id in movie.booked_seats %}
              <div class="seat reserved" style="background-color: gray;" data-seat="{{ seat_id }}" data-price="{{ price }}">{{ col }}</div>
            {% else %}
              <div class="seat available" style="background-color: {{ seat_color }};" data-seat="{{ seat_id }}" data-price="{{ price }}">{{ col }}</div>
            {% endif %}
          {% endfor %}
        </div>
      {% endfor %}

      <input type="hidden" id="seats" name="seats">
      <input type="hidden" name="movie_id" value="{{ movie.id }}">
      <input type="hidden" id="total_price" name="total_price">



      <div class="text-center mt-3">
        <p><strong>Selected Seats:</strong> <span id="seatList"></span></p>
        <p><strong>Total Price:</strong> ₹<span id="priceTotal">0</span></p>
        <button type="submit" class="btn btn-success mt-2">Confirm Booking</button>
      </div>
    </form>
  </div>

  <script>
    let selectedSeats = [];
    let total = 0;
    document.querySelectorAll('.available').forEach(seat => {
      seat.addEventListener('click', () => {
        const seatId = seat.getAttribute('data-seat');
        const seatPrice = parseInt(seat.getAttribute('data-price'));
        if (seat.classList.contains('selected')) {
          seat.classList.remove('selected');
          selectedSeats = selectedSeats.filter(s => s.id !== seatId);
        } else {
          seat.classList.add('selected');
          selectedSeats.push({ id: seatId, price: seatPrice });
        }

        document.getElementById('seats').value = selectedSeats.map(s => s.id).join(',');
        document.getElementById('total_price').value = selectedSeats.reduce((sum, s) => sum + s.price, 0);
        document.getElementById('seatList').textContent = selectedSeats.map(s => s.id).join(', ');
        document.getElementById('priceTotal').textContent = selectedSeats.reduce((sum, s) => sum + s.price, 0);
      });
    });
  </script>
</body>
</html>
